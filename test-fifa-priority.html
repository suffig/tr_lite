<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIFA Service Data Priority Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .log { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 10px 0; border-radius: 5px; white-space: pre-wrap; font-family: monospace; }
    </style>
</head>
<body>
    <h1>FIFA Service Data Priority Test</h1>
    <p>Testing that JSON data is loaded first, then SoFIFA if not available.</p>
    
    <button onclick="runTests()">Run Tests</button>
    <div id="results"></div>
    <div id="logs"></div>

    <script type="module">
        import { FIFADataService } from './src/utils/fifaDataService.js';

        window.runTests = async function() {
            const results = document.getElementById('results');
            const logs = document.getElementById('logs');
            results.innerHTML = '';
            logs.innerHTML = '';
            
            // Capture console logs
            const originalLog = console.log;
            const originalWarn = console.warn;
            const originalError = console.error;
            const logBuffer = [];
            
            console.log = (...args) => {
                logBuffer.push('[LOG] ' + args.join(' '));
                originalLog(...args);
            };
            console.warn = (...args) => {
                logBuffer.push('[WARN] ' + args.join(' '));
                originalWarn(...args);
            };
            console.error = (...args) => {
                logBuffer.push('[ERROR] ' + args.join(' '));
                originalError(...args);
            };

            try {
                // Test 1: Player that exists in JSON database
                results.innerHTML += '<div class="test-result"><h3>Test 1: Player in JSON database (Virgil van Dijk)</h3>';
                const test1Result = await FIFADataService.getPlayerData('Virgil van Dijk', { useLiveData: false });
                if (test1Result && test1Result.source === 'mock_database') {
                    results.innerHTML += '<div class="success">✅ PASS: Found player in JSON database, source: ' + test1Result.source + '</div>';
                } else {
                    results.innerHTML += '<div class="error">❌ FAIL: Expected to find player in JSON database</div>';
                }
                results.innerHTML += '</div>';

                // Test 2: Player that doesn't exist in JSON database
                results.innerHTML += '<div class="test-result"><h3>Test 2: Player NOT in JSON database</h3>';
                const test2Result = await FIFADataService.getPlayerData('Unknown Player XYZ', { useLiveData: false, fallbackToMock: true });
                if (test2Result && test2Result.source === 'generated_default') {
                    results.innerHTML += '<div class="success">✅ PASS: Player not in JSON, generated default data, source: ' + test2Result.source + '</div>';
                } else {
                    results.innerHTML += '<div class="warning">⚠️ Different result: source = ' + (test2Result?.source || 'null') + '</div>';
                }
                results.innerHTML += '</div>';

                // Test 3: Fuzzy matching test
                results.innerHTML += '<div class="test-result"><h3>Test 3: Fuzzy matching (Van Dijk)</h3>';
                const test3Result = await FIFADataService.getPlayerData('Van Dijk', { useLiveData: false });
                if (test3Result && test3Result.source === 'mock_database_fuzzy') {
                    results.innerHTML += '<div class="success">✅ PASS: Fuzzy match worked, source: ' + test3Result.source + '</div>';
                } else {
                    results.innerHTML += '<div class="warning">⚠️ Different result: source = ' + (test3Result?.source || 'null') + '</div>';
                }
                results.innerHTML += '</div>';

                // Test 4: Data priority test (JSON first, then SoFIFA if enabled)
                results.innerHTML += '<div class="test-result"><h3>Test 4: Data priority with live data enabled</h3>';
                const test4Result = await FIFADataService.getPlayerData('Virgil van Dijk', { useLiveData: true });
                if (test4Result && (test4Result.source === 'sofifa_enhanced' || test4Result.source === 'mock_fallback' || test4Result.source === 'mock_error_fallback')) {
                    results.innerHTML += '<div class="success">✅ PASS: Attempted SoFIFA enhancement (or fell back gracefully), source: ' + test4Result.source + '</div>';
                } else {
                    results.innerHTML += '<div class="warning">⚠️ Different result: source = ' + (test4Result?.source || 'null') + '</div>';
                }
                results.innerHTML += '</div>';

                // Display logs
                logs.innerHTML = '<h3>Console Logs:</h3><div class="log">' + logBuffer.join('\n') + '</div>';

            } catch (error) {
                results.innerHTML += '<div class="error">❌ TEST ERROR: ' + error.message + '</div>';
                logs.innerHTML = '<h3>Console Logs:</h3><div class="log">' + logBuffer.join('\n') + '</div>';
            }

            // Restore console
            console.log = originalLog;
            console.warn = originalWarn;
            console.error = originalError;
        };
    </script>
</body>
</html>